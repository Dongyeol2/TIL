# Network 기초

인터네트워킹 프로토콜은 IGP와 EGP로 나눌  수 있다. IGP는 기관내 혹은 조직내 라우팅에 사용하며 대표적인 표준 프로토콜로는 RIP, OSPF등이 있는데 작은 규모의 네트워크에서는 RIP를 사용하고 대규모의 계층적 구조에서 OSPF를 많이 사용한다.

그에 반하여 EGP는 연구기관이나 국가기관, 대학, 기업간, 즉 도메인 간을 연결하는 인터넷 라우팅 프로토콜이다, 예를 들면 한 공인된 기관이 ISP인 한국통신이나 데이콤과 인터넷으로 연결할 때는 ISP와 연결하는 AS라우터에 EGP의 한 종류인 BGP를 적용하여 연결하며, 그 기관의 내부 통신 프로토콜로는 RIP이나 OSPF를 적용하는 것이 일반적이다.

## 1. RIP ver1/2

RIP v1과 RIP v2는 디스턴트 벡터 라우팅 프로토콜이라는 점과 UDP 520번을 사용한다는 점 말고는 공통점이 없다.

### - 차이점

Rip v1은 서브넷 마스크 정보가 없는 라우팅 정보를 전송하는 classful 라우팅 프로토콜

Rip v2는 서브넷 마스크 정보가 포함된 라우팅 정보를 전송할 수 있는 classless 라우팅 프로토콜

가장 큰 차이점은 라우팅 정보에 서브넷 마스크 길이가 포함된다. 즉 Rip v1은 특정 네트워크 정보를 전송할 때 서브넷 마스크 길이를 알려주는 기능이 없지만 Rip v2는 네트워크 정보와 함께 서브넷 마스크 길이까지 같이 전송한다.

`Rip v1`은 라우팅 정보 전송 시 목적지 주소로 브로드캐스트 주소(255.255.255.255)를 사용하지만 `Rip v2`는 **1)멀티캐스트 주소를 사용**한다. Rip v2는 **2) Rip를 사용하지 않는 장비에게 불필요한 부하가 걸리는 것을 방지**. Rip v2는 OSPF, EIGRP, BGP와 같이 **3) 라우팅 정보를 인증할 수 있어 보안성 강화** 광고되는 네트워크에 **4) tag를 달 수 있어 경로 관리가 편리**.  **5) 특정 네트워크로 가는 패킷의 next hop을 표시하여 불필요한 라우터를 거치는 것을 방지**한다.

## 2. IGRP

**내부 게이트웨이 라우팅 프로토콜(Interior Gateway Routing Protocol, IGRP)**은 시스코사가 발명한 거리 벡터 내부 데이트웨이 프로토콜(IGP)이다. 자율 시스템 내의 라우팅 데이터를 교환할 목적으로 라우터가 사용한다.

IGRP는 사유 프로토콜이다. IGRP는 대형 망에서 사용할 때 RIP의 제약(최대 홉 수가 15개, 하나의 라우팅 메트릭 -> RIP의 단점중 하나)을 부분적으로나마 극복할 목적으로 만들어졌다. IGRP는 대역폭, 지연, 부하, MTU, 신뢰성을 포함하여 개별 경로에 여러 대의 메트릭을 지원한다. 두 개의 경로를 비교하기 위해 이 메트릭들은 미리 설정된 상수들을 사용하여 수정할 수 있는 공식을 이용하여 하나의 메트릭으로 병합된다. IGRP 라우티드 패킷의 최대 홉 수는 255(기본값 100)이며 라우팅 업데이트는 (기본값으로) 90초마다 브로드캐스트 된다.

IGRP는 클래스가 있는 라우팅 프로토콜로 간주된다. 이 프로토콜이 서브넷 마스크를 위한 공간이 없기 때문에 라우터는 동일 클래스 A, 클래스 B, 클래스 C 네트워크 안의 모든 서브넷 주소들이 인터페이스에 구성된 서브넷 마스크와 동일한 서브넷 마스크를 소유하고 있는 것으로 추측한다. 이는 VLSM(가변 서브넷 마스크)를 사용할 수 있는 클래스 없는 라우팅 프로토콜과 대비된다.

### - RIP vs IGRP

1. 증가된 확장성 : RIP을 사용하는 네트워크와 비교하여 중대형 네트워크에서의 라우팅이 개선되었다. RIP에서 15개로 제한되어 있는 홉 문제를 IGRP는 최대 255개로 확장하여 이를 극복할 수 있게 되엇다.

2. 정교한 메트릭 : RIP의 메트릭은 홉 수인데 비해 IGRP에서는 기본적으로 지연과 대역폭을 사용하며 추가로 신뢰성, 로드, MTU 등을 메트릭 계산에 포함시킨다.\

3. 다중 경로 지원 : IGRP는 네트워크 송신지와 수신지 사이에서 비용이 동일하지 않은 경로를 6개까지 유지할 수 있다. RIP와 달리 이 경로들이 동일한 비용일 필요는 없다.

   ![IGRP](./imgs/igrp.PNG)

   그림을 보고 RIP와 비교해보자. RIP는 경로 결정 기준이 오직 홉 수에 의해 결정되기 때문에 호스트 1에서 호스트 2로 패킷을 전송할 때 라우터 A는 라우터 B로 라우팅을 한다. 이것은 라우터 D,C 를 경유하는 것보다 홉 수가 작기 때문이다. 그러나 대역폭을 비교해보면 홉 수만을 고려한 것이 최상의 선택이 아님을 알 수 있다. 바로 IGRP는 복합 메트릭을 사용하여 대역폭이 좋은 A-D-C-B의 경로를 선택하게 되는 것이다.

## 3. EIGRP

**EIGRP(강화 내부 경로 제어 통신 규약, Enhanced Interior Gateway Routing Protocol)**는 시스코사가 만든 원래의 IGRP를 기반으로 한 *개방형 라우팅 프로토콜*이다. EIGRP는 라우터 내 대역폭 및 처리 능력의 이용뿐 아니라, 토폴로지(망 구성 방식)가 변경된 뒤에 일어나는 불안정한 라우팅을 최소화하는데 최적화된 고급 거리 벡터 라우팅 프로토콜이다. EIGRP는 지원하는 라우터들은 32비트 EIGRP 메트릭을 24비트 IGRP 메트릭으로 변환함으로써 IGRP의 이웃 장비들에게 경로 정보를 자동으로 재분배한다. 라우팅 최적화 대부분이 SRI사의 확산 업데이트 알고리즘(DUAL, Diffusing update algorithm)의 처리에 기반을 두므로, 빠른 수렴(convergence)을 위한 메커니즘을 제공하고 루프문제에서 자유롭다.

### 기본동작

EIGRP는 데이터를 세 개의 테이블에 저장한다.

1. 이웃 테이블(Neighbor Table) : 이웃 라우터들에 대한 데이터를 저장한다. (직접 연결된 인터페이스를 통해 직접 접근할 수 있는 데이터)
2. 토폴로지 테이블 : 이름과는 다르게 완전한 네트워크 토폴로지의 개요를 저장하지는 않는다. 이 테이블에는 개별 메트릭과 더불어 EIGRP 라우티드 네트워크의 목적지 네트워크의 목록을 포함한다. 또 모든 목적지에 대해 **successor와 feasible successor가 식별**되며 이들이 존재하면 테이블에 저장된다. 토폴로지 테이블 내의 모든 목적지는 "Passive" 또는 "Active"로 표시된다.
3. 라우팅 테이블 : 모든 목적지에 대한 실제 경로를 저장한다.

### Successor (최적의 경로)

어느 특정 목적지를 위한 successor는 아래의 두 조건을 만족하는 다음의 홉 라우터를 가리킨다.

1. 목적지에 대한 최소 거리를 제공한다.
2. 동일한 라우팅 루프의 일부가 아님이 확실하다.

목적지에 대한 successor는 토폴로지 테이블에 기록되며 그 뒤에 이들은 해당 목적지에 대한 다음 홉으로서 라우팅 테이블을 상주시키는데 사용된다.

### feasible successor (차선경로)

어느 특정 목적지를 위한 feasible successor는 아래의 조건을 만족하는 다음 홉 라우터이다.

/- 특정 라우팅 루프의 일부가 아님이 확실하다.

모든 successor는 feasible successor이기도 하다. 그러나 EIGRP에 대한 대부분의 참조에서 feasible successor는 successor가 아닌, 루프에서 자유로운 경로를 제공하는 라우터들로 한정하는데 사용된다. 이러한 관점에서 도달 가능한 목적지의 경우 적어도 하나의 successor가 존재하지만 feasible successor는 존재할 수도, 존재하지 않을 수도 있다.

### IGRP vs EIGRP

1. IGRP는 classful 주소 지정을 지원하고 EIGRP는 클래스없는 라우팅 사용을 허용한다.
2. 대역폭과 지연을 위해 IGRP는 24비트가 할당된다. 반면에 EIGRP에는 대역폭과 지연을 위해 32비트가 할당된다.
3. IGRP의 홉 수는 255이고, EIGRP의 경우 홉 수는 256이다.
4. IGRP의 수렴은 EIGRP에 비해 느리다.
5. IGRP에서 90초마다 주기적 업데이트가 장치로 전송된다. 반대로 EIGRP는 변경사항이 발생할 경우에만 업데이트를 보낸다.
6. EIGRP는 DUAL 알고리즘을 따른다. 반대로, IGRP는 bellman ford 알고리즘을 사용한다.
7. IGRP의 관리거리는 100이다. 반면, EIGRP 경로는 행정 거리가 90이다.
8. IGRP의 대역폭 요구량은 EIGRP에 필요한 양보다 많다.

### 결론

EIGRP의 라우팅 성능은 링크 상태 라우팅의 기능을 거리 벡터 라우팅과 통합했기 때문에 IGRP와 비교하여 향상되었다. 경로 재분배 문제는 IGRP에 있는 동안 EIGRP에서 제거된다.

## 4. OSPF

**OSPF(최단 경로 우선 프로토콜, Open Shortest Path First)**는 인터넷 프로토콜(IP) 네트워크를 위한 링크 스테이트 라우팅 프로토콜이다. 링크 스테이트 라우팅 알고리즘을 사용하며, 하나의 자율 시스템(AS)에서 동작하면서 내부 라우팅 프로토콜의 그룹에 도달한다. IPv4의 경우 RFC 2328의 OSPF 버전 2로 정의되어 있다. IPv6를 위한 업데이트는 RFC 5340의 OSPF 버전 3에 정의되어 있다.

OSPF는 대기업망에서 가장 널리 쓰이는 내부 게이트웨이 프로토콜(IGP)로 간주된다. 또 다른 링크 스테이트 동적 라우팅 프로토콜인 IS-IS는 대형 서비스 제공자망에서 더 일반적으로 쓰인다. 가장 널리 쓰이는 외부 게이트웨이 프로토콜은 인터넷 상에서 자율 시스템 간에 쓰이는 주요 라우팅 프로토콜인 경계 경로 프로토콜(BGP)이다.

### 영역의 종류

OSPF 도메인은 32비트 영역들로 분리된다. 이 영역 식별자들은 무조건은 아니지만 일반적으로 IPv4 주소의 닷 데시멀 노테이션으로 작성된다. 그러나 이들은 IP주소가 아니며, 어떠한 IPv4 주소라도 충돌 없이 복제할 수 있다. IPv6의 OSPF 영역 식별자(OSPFv3)들은 동일한 노테이션으로 작성된 32비트 식별자들을 사용한다.

- 백본 영역
- 스텁 영역
- NSSA(not-so-stubby area)
- 사유 확장
  + 완전한 스텁 역역(totally stubby area)
  + NSSA의 완전한 스텁 영역
- 트랜짓(Transit) 영역

### OSPF 라우터의 종류

OSPF는 다음의 라우터 종류를 정의한다.

- ABR(area border router, 영역 경계 라우터)
- ASBR(autonomous system boundary router, 자율 시스템 경계 라우터)
- IR(internal router, 내부 라우터)
- BR(backbone router, 백본 라우터)

## 5. EGP

**EGP(Exterior Gateway Protocol)

## 6. BGP