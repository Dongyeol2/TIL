



# Netconf(Network Configuration Protocol)

## Netconf Overview

### :grey_question: what's NETCONF?

- IETF에서 개발하고 표준화 한 네트워크 관리 프로토콜
- NETCONF 프로토콜 사양은 인터넷 표준 추적 문서
- NETCONF는 네트워크 장치의 구성을 설치, 조작 및 삭제하는 메커니즘을 제공 - 이 작업은 RPC(원격 프로시저 호출) 계층에서 구현됨.
- NETCONF는 TCP/SSH 위에서 정의되는 응용 계층 프로토톨로 주로 xml 형식과 그 형식에 따른 동작에 대한 내용이 주가 도니다. 

### NETCONF Layer 구조

![image](https://user-images.githubusercontent.com/50439622/99021400-f083d280-25a3-11eb-8a55-c79b0c29904d.png)

```
example 기준으로 설명.
<rpc> 태그는 message 단위를 정의한다. 이외에 그 응답인 <rpc-reply>와 이벤트 발생 시 그 알림을 위한 <notofication>이 있다. 그 내부의 <edit-config>는 message로 전달하고자 하는 동작의 종류를 정의한다.

- <get> : 현재 사용 중인 설정 및 장치 상태 정보를 요청
- <get-config> : configuration datastore (netconf에서의 configuration set 단위) 를 요청
- <edit-config> : 내용 편집
- <copy-config> : 다른 datastore로 복사
- <delete-config> : 삭제 요청
- <lock>, <unlock> : configuration datastore 수정 앞뒤로 lock/unlock을 건다
- <close-session> : NETCONF session을 절차적으로 종료
- <kill-session> : 기타 다른 문제 등으로 인해 강제 종료

그 내부 계층에는 YANG 형식으로 정의된 content가 <config> ... </config> 태그로 싸서 들어가게 된다.

```



### :grey_question: what's YANG?

```
YANG(yet another next generation)은 IETF에서 표준화한 데이터 모델링 언어로 NETCONF로 전달하기 위한 데이터의 모델링을 위해 사용한다. RFC 6020에서는 YANG 자체의 구조와 선언, 타입에 대한 정의를 한다. 예를 들어, 다음과 같은 NETCONF XML 데이터를 만들기 위한 데이터 모델링을 정의한다.
```

![image](https://user-images.githubusercontent.com/50439622/99022499-3477d700-25a6-11eb-92dd-98e3fec3d61f.png)
![image](https://user-images.githubusercontent.com/50439622/99022519-3c377b80-25a6-11eb-848a-cbd55f1fad7b.png)

```
위의 예시처럼 각 프로토콜 별로 그에 맞는 데이터 모델을 YANG 형식으로 정의해야 한다.
(like SNMP MIB)
```

```
네트워크 관리 프로토콜 SNMP 가 존재. UDP 기반, MIB 기반의 데이터 모델이 장비 설정 관리에 효율적이지 못하다는 단점이 존재.

클라우드, SDN(Software defined Network), NFV(Network function Virtualization) 등 기존 HW 기반 on-premise 중심에서 탈피한 새로운 개념의 네트워크 환경이 대두되면서, 관리가 필요한 네트워크 노드의 수와 종류가 비교할 수 없이 커지고 네트워크 설정의 자동화의 필요성이 높아졌다. NETCONF, YANG은 이러한 환경에 적합한 네트워크 관리 프로토콜로 정의되었다.
```



### :grey_question: what's RPC (Remote Procedure call) ?

```
 RPC(Remote Procedure call)이란, 별도의 원격 제어를 위한  코딩 없이 다른 주소 공간에서 리모트의 함수나 프로시저를 실행 할 수 있게 해주는 프로세스간 통신이다. 즉, 위치에 상관없이 RCP를 통해 개발자는 원하는 함수를 사용할 수 있다.
 RPC는 IPC(Inter-Process Communication) 방법의 한 종류로 원격지의 프로세스에 접근하여 프로시저 또는 함수를 호출하여 사용하는 방법을 말한다.
```

![image](https://user-images.githubusercontent.com/50439622/99014139-79474200-2595-11eb-88cf-3033af02349c.png)

1. IDL(Interface Definition Language) 을 사용하여 서버의 호출 규약을 정의한다.
   - 함수명, 인자, 반환값에 대한 데이터형이 정의된 IDL 파일을 rpcgen 컴파일러를 이용하여 stub 코드를 자동으로 생성한다,
2. stub는 원시소스코드(c코드 등) 형태로 만들어지므로 클라이언트, 서버 프로그램에 포함하여 빌드한다.
3. 클라이언트 프로그램 입장에서 자신의 프로세스 주소공간의 함수를 호출하는 것과 동일하게 stub에 정의된 함수를 호출할 수 있게 된다.
4. stub 코드는 데이터형을 XDR(eXtrenal Data Representation) 형식으로 변환하여 RPC 호출을 실행한다.
   - XDR 변환 이유는 기본 데이터 타입(정수형, 부동소수점 등)에 대한 메모리 저장방식(리틀엔디안, 빅엔디안)이 CPU 아키텍처 별로 다르며, 네트워크 전송과정에서 바이트 전송 순서를 보장하기 위함이다.
5. 서버는 수신된 함수/프로시저 호출에 대한 처리 완료 후, 결과값을 XDR 변환하여 반환한다.
6. 최종적으로 클라이언트 프로그램은 서버의 결과값을 반환받는다.

## Netconf 프로토콜

![image](https://user-images.githubusercontent.com/50439622/99017766-f675b580-259b-11eb-8e2e-a7397b9c6398.png)

- Netconf 프로토콜은 개념적으로 4개의 계층으로 분할 될 수 있다.
  1. Content 계층 : 구성 데이터와 알림 데이터로 구성
  2. Operations 계층 : 구성 데이터를 검색하고 편집하기 위한 일련의 기본 프로토콜 작업을 정의
  3. Message 계층 : RPC(원격 프로시저 호출) 및 알림을 인코딩하는 메커니즘 제공
  4. Secure Transport 계층 : 클라이언트와 클라이언트 간에 안전하고 안정적인 메시지 전송 제공

## RFC 6241

```
네트워크 장치의 구성을 설치, 조작 및 삭제하는 메커니즘을 제공. 구성 데이터 및 프로토콜 메시지에 대해 XML(Extensible Markup Language) 기반 데이터 인코딩을 사용함. NETCONF 프로토콜 작업은 RPC(원격 프로시저 호출)로 실현됨. RFC4741 더이상 사용 안함(폐기)
```



##  RFC 6020





